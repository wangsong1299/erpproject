 {% extends "base_erp.html" %}
 {% load i18n admin_static %}

{% block head %}
<link rel="stylesheet" href="{% static "erp/css/sales.css" %}">
{% endblock %}

			{% block inner_header %}
					
			{% endblock %}	


 {% block main %}
 <div class="main" style="overflow:hidden">
 	<div class="line2">
	销售：成本单	
	</div>	

 	<div class="head_row">
 			<label for="productID" style="width:200px">产品ID（施工单号）</label>
 			<input  type="text" id="productID" value={{records.0 }} disabled>
 		</div>
 	<table class="cost_table" style="margin-top: 20px;">
		<tr>
			<th class="col_15">客户名<span class="red">*</span></th>
			<td class="col_20"> <input type="text" id="customer_name"   value={{records.1 }}></td>
			<th class="col_15">产品名称<span class="red">*</span></th>
			<td class="col_20"> <input type="text" id="product_name"   value={{records.2 }}></td>
			<th class="col_10">日期<span class="red">*</span></th>
			<td class="col_20"> <input type="text" id="create_time"    value={{records.3 }} onClick="WdatePicker()"></td>
		</tr>
	</table>
 	<table class="cost_table">
		<tr>
			<th class="col_15">表面处理<span class="red">*</span></th>
			<td class="col_55"> <input type="text" id="surface"    value={{records.4}} ></td>
			<td class="col_30"> <input type="text" id="surface_price"    value={{records.5 }}></td>
		</tr>
		<tr>
			<th class="col_15">原料名称<span class="red">*</span></th>
			<td class="col_55">
					<select name="material" id="material" style="width:100%;margin-right:0">
 			 			<option value="1">250克灰底白板</option>
 			 			<option value="2">250克白底白板</option>
						<option value="3">300克灰底白板</option>
						<option value="4">300克白底白板</option>
						<option value="5">350克灰底白板</option>
						<option value="6">350克白底白板</option>
						<option value="7">400克灰底白板</option>
						<option value="8">400克白底白板</option>
						<option value="9">450克灰底白板</option>
						<option value="10">450克白底白板</option>
						<option value="11">80克双胶纸</option>
						<option value="12">100克双胶纸</option>
						<option value="13">128克铜版纸</option>
						<option value="14">157克铜版纸</option>
						<option value="15">210克白卡</option>
						<option value="16">230克白卡</option>
						<option value="17">250克白卡</option>
						<option value="18">300克白卡</option>
						<option value="15">350克白卡</option>
						<option value="16">250克铜版卡</option>
						<option value="17">300克铜版卡</option>
						<option value="18">350克铜版卡</option>
 			 		</select>				 		
			</td>
			<td class="col_30"> 
				<select name="material_price" id="material_price" style="width:100%;margin-right:0">
 			 			<option value="1">0.80</option>
 			 			<option value="2">0.92</option>
						<option value="3">0.92</option>
						<option value="4">1.04</option>
						<option value="5">1.04</option>
						<option value="6">1.18</option>
						<option value="7">1.18</option>
						<option value="8">1.34</option>
						<option value="9">1.33</option>
						<option value="10">1.51</option>
						<option value="11">0.45</option>
						<option value="12">0.58</option>
						<option value="13">0.68</option>
						<option value="14">0.83</option>
						<option value="15">1.05</option>
						<option value="16">1.15</option>
						<option value="17">1.18</option>
						<option value="18">1.41</option>
						<option value="15">1.65</option>
						<option value="16">1.24</option>
						<option value="17">1.49</option>
						<option value="18">1.74</option>
 			 		</select>	
 			 	</td>
		</tr>
		<tr>
			<th class="col_15">底纸用料<span class="red">*</span></th>
						<td class="col_55">
				<select name="wl_feizhi" id="wl_feizhi" style="width:100%;margin-right:0">
 			 			<option value="1">0g</option>
 			 			<option value="2">90g</option>
						<option value="3">100g</option>
						<option value="4">110g</option>
						<option value="5">120g</option>
 			 		</select>	
 			 	</td>
			<td class="col_30">
			<select name="wl_feizhi_price" id="wl_feizhi_price" style="width:100%;margin-right:0">
 			 			<option value="1">0</option>
 			 			<option value="2">0.85</option>
						<option value="3">0.9</option>
 			 	</select>
 			 </td>
		</tr>
		<tr>
			<th class="col_15">瓦楞用料<span class="red">*</span></th>
		<td class="col_55">
			<select name="wl_waleng" id="wl_waleng" style="width:100%;margin-right:0">
 			 			<option value="1">0g</option>
 			 			<option value="2">90g</option>
						<option value="3">110g</option>
 			 	</select>
 			 </td>
			<td class="col_30">
			<select name="wl_waleng_price" id="wl_waleng_price" style="width:100%;margin-right:0">
 			 			<option value="1">0</option>
 			 			<option value="2">0.85</option>
						<option value="3">0.9</option>
 			 	</select>
			</td>
		</tr>
	</table>
 	<table class="cost_table">
		<tr>
		<th class="col_15">大料张数<span class="red">*</span></th>
			<td class="col_85"> <input type="text" id="daliao"    value={{records.12 }} ></td>
		</tr>
		<tr>
		<th class="col_15">开料尺寸<span class="red">*</span></th>
			<td class="col_85"> <input type="text" id="size"     value={{records.13 }}></td>
		</tr>
		<tr>
		<th class="col_15">人工费</th>
			<td class="col_85"> <input type="text" id="worker_fee"    value={{records.14 }} ></td>
		</tr>
		<tr>
		<th class="col_15">其他</th>
			<td class="col_85"> <input type="text" id="other_fee"    value={{records.15 }} ></td>
		</tr>
		<tr>
		<th class="col_15">备注</th>
			<td class="col_85"> <input type="text" id="notes"    value={{records.16 }} ></td>
		</tr>
		<th class="col_15">成本<span class="red">*</span></th>
			<td class="col_85"> <input type="text" id="total_fee"    value={{records.17 }} ></td>
		</tr>
	</table>

 		<div class="head_row" style="display:none" id="add_box">
 			<button type="submit" class="btn btn-primary" id="add">点击计算总成本</button>
 		</div>

  	
	 <div class="head_row last_row" style="margin-bottom:40px">
 		   <button type="submit" class="btn btn-primary" id="delete">删除</button>
 		   <button type="submit" class="btn btn-primary" id="modify">修改</button>
 		   <button type="submit" class="btn btn-primary" id="print" onclick="javascript:window.print()" />打印</button>
 		</div>
  </div>
  <OBJECT classid="CLSID:8856F961-340A-11D0-A96B-00C04FD705A2" height="0" id="wb" name="wb" width="0">
        </OBJECT>
 {% endblock %}

{% block javascript %}

 	<script type="text/javascript">
	$(document).ready(function(){
		$("#sales_box").show();	

		$("#cost").addClass('subtitle_focus');	


		 var href =window.location.href.split("/");
		 var id = href[5];

		 var mater={{records.6}};
		$("option").each(function(a,b){
                if($(b).val()==mater){//判断值
                    $(b).attr("selected",true);
                }
		});

		var wl_feizhi={{records.8}};
		$("#wl_feizhi>option").each(function(a,b){
                if($(b).val()==wl_feizhi){//判断值
                    $(b).attr("selected",true);
                }
		});
		var wl_waleng={{records.9}};
		$("#wl_waleng>option").each(function(a,b){
                if($(b).val()==wl_waleng){//判断值
                    $(b).attr("selected",true);
                }
		});
		$("#wl_waleng_price>option").each(function(a,b){
                if($(b).val()==wl_waleng){//判断值
                    $(b).attr("selected",true);
                }
		});
		$("#wl_feizhi_price>option").each(function(a,b){
                if($(b).val()==wl_waleng){//判断值
                    $(b).attr("selected",true);
                }
		});



		 $("#delete").click(function(){
			$.ajax({
              type : "POST",
              url : "/sales/delete_cost/",
              data:{'id':id},
              dataType : "json",
              success : function(data) {    
                if(data==1){
                	alert("删除成功");
                   	window.location.href='/sales/cost/';
                }else{
                  alert("删除失败:"+data.message);
                }
              }
         })
		})

     	var href =window.location.href.split("/")[5];
	
		//show页
		var cost_show={{ cost_show }};
		if(cost_show){
			$('input').attr('disabled',true);
			$('select').attr('disabled',true);
			$('#modify').click(function(){
				window.location.href='/sales/cost_modify/'+href;
			})
		}

		var cost_modify={{ cost_modify }};
		if(cost_modify){
			$('#print').attr('disabled',true);
			$('#modify').html('确认修改');

			var date=new Date();
			var newdate= date.getFullYear()+'-'+(parseInt(date.getMonth())+1)+'-'+date.getDate();
			$("#create_time").val(newdate);


			$("#add_box").show();
			$("#add").click(function(){
				var surface_price=Number($("#surface_price").val()).toFixed(2);
				var material_price=Number($("#material_price").val()).toFixed(2);
				var wl_waleng_price=Number($("#wl_waleng_price").val()).toFixed(2);
				var daliao=$("#daliao").val();
				var size=$("#size").val();
				var worker_fee=Number($("#worker_fee").val()).toFixed(2);
				var other_fee=Number($("#other_fee").val()).toFixed(2);
				var total_fee=(parseFloat(surface_price)+parseFloat(material_price)+parseFloat(wl_waleng_price))*parseFloat(daliao)*parseFloat(size)+parseFloat(worker_fee)+parseFloat(other_fee);
				$("#total_fee").val(total_fee);
			})


			$("#modify").click(function(){
				var productID=$("#productID").val();
				var customer=$.trim($("#customer_name").val());
				var create_time=$.trim($("#create_time").val());
				var product_name=$.trim($("#product_name").val());
				var surface=$("#surface").val();
				var material=$("#material").val();
				var wl_waleng=$("#wl_waleng").val();
				var wl_feizhi=$("#wl_feizhi").val();
				var surface_price=Number($("#surface_price").val()).toFixed(2);
				var material_price=Number($("#material_price").val()).toFixed(2);
				var wl_waleng_price=Number($("#wl_waleng_price").val()).toFixed(2);
				var wl_feizhi_price=Number($("#wl_feizhi_price").val()).toFixed(2);
				var daliao=$("#daliao").val();
				var size=$("#size").val();
				var worker_fee=Number($("#worker_fee").val()).toFixed(2);
				var other_fee=Number($("#other_fee").val()).toFixed(2);
				var notes=$("#notes").val();
				var total_fee=Number($("#total_fee").val()).toFixed(2);
		
				if(total_fee==0){
					alert("请点击生成总额,成本不能为0");
				}else{
					$.ajax({
			              type : "POST",
			              url : "/sales/modify_cost/",
			              data:{'productID':productID,'customer':customer,'create_time':create_time,'product_name':product_name,'surface':surface,'material':material,'wl_waleng':wl_waleng,'wl_feizhi':wl_feizhi,'surface_price':surface_price,'material_price':material_price,'wl_waleng_price':wl_waleng_price,'wl_feizhi_price':wl_feizhi_price,'daliao':daliao,'size':size,'worker_fee':worker_fee,'other_fee':other_fee,'notes':notes,'total_fee':total_fee},
			              dataType : "json",
			              success : function(data) {    
			                if(data==1){
			                	alert("修改成功");
			                   window.location.reload();
			                }else{
			                  alert("修改失败:"+data.message);
			                }
			              }
			          })

				}
				
			})


		}




	})</script>

{% endblock %}